<section id="basic-form-layouts">
    <div class="row">
      <div class="col-md-12">
        <div class="card box-shadow-3">
          <div class="card-header">
            <div class="card-title-wrap bar-success">
              <h4 th:if="${pleca.id_pleca == null}" class="card-title" id="basic-layout-form">Nuevo Registro - Pleca</h4>
              <h4 th:if="${pleca.id_pleca != null}" class="card-title" id="basic-layout-form">Actualizar Registro - Pleca</h4>
            </div>
            <p class="mb-0">El registro corresponde a la información detallada de la Pleca</p>
          </div>
          <div class="card-body">
            <div class="px-3">

                <form id="form1" action="/RegistroPlecaF" class="form" method="post" novalidate>
            
                  <input type="hidden" th:field="${pleca.id_pleca}">
                  <div class="row">
                      <div class="col-lg-8 col-md-12">
                          <h4 class="form-section"><i class="icon-notebook"></i> Datos Principales</h4>
                      </div>
                      <div class="col-lg-4 col-md-12">
                          <h4 class="form-section"><i class="icon-book-open"></i> Detalles de la Pleca</h4>
                      </div>
                  </div>
                
                <div class="row">
                  <div class="col-lg-8 col-md-12">
                    <div class="form-group">
                      <label>Tema de la Pleca</label>
                      <div class="controls">
                          <input th:field="${pleca.tema_pleca}" type="text" name="text" class="form-control" required data-validation-required-message="Necesita ingresar los datos">
                      </div>                      
                    </div>
                  </div>
                  <div class="col-lg-4 col-md-12">
                    <div class="form-group">
                      <label>Del Programa:</label>
                      <button type="button" class="badge badge-pill badge-dark" data-toggle="popover" th:data-content="${'<b> Los Programas que se muestran son de la Gestión actual ' + ano_actual +'</b>'}" data-original-title="Ayuda" data-html="true" data-trigger="focus">
                        ❔
                      </button>
                      <div class="controls">
                        <select style="width: 100%;" th:field="${pleca.programa}" id="select88" required class="selectB form-control">

                          <th:block th:each="pro : ${programas}" th:if="${pro.est_programa == 'A' && pro.ano_programa == ano_actual}">
                            <option th:value="${pro.id_programa}" th:text="${pro.desc_programa}"></option>
                          </th:block>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-8 col-md-12">
                    <div class="form-group">
                      <label>Presentadores</label>
                      <button type="button" class="badge badge-pill badge-dark" data-toggle="popover" 
                        data-content="<b>Puede Agregar a más de un Presentador</b>" data-original-title="Ayuda" data-html="true" data-trigger="focus">
                        ❔
                      </button>
                      <div class="controls">
                          <select style="width: 100%;" th:field="${pleca.personas}" id="select1" required class="selectM form-control" multiple="multiple">
                            <th:block th:each="p : ${personas}" th:if="${p.estado_persona == 'A'}">
                              <option th:value="${p.id_persona}" th:text="${p.nombre+' '+p.ap_paterno+' '+p.ap_materno}"></option>
                            </th:block>
                          </select>
                      </div>                      
                    </div>
                  </div>
                  <div class="col-lg-4 col-md-12">
                        <div class="form-group">
                          <label>Fecha de la Pleca</label>
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">
                                <span class="fa fa-calendar-o"></span>
                              </span>
                            </div>
                            <input th:field="${pleca.f_pleca}"  class="form-control" type="date" required>
                          </div>                                    
                      </div>
                      <!--  -->
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-8 col-md-12">
                    <div class="form-group">
                      <label>Nombre de los Invitados</label>
                      <button type="button" class="badge badge-pill badge-dark" data-toggle="popover" 
                        data-content="<b>Seguir la Redacción</b> <hr> <b> Ejemplo </b> <br> - Nombre del 1er Invitado.   <br>  - Nombre del 2do Invitado  <br>  - Nombre del 3er Invitado" data-original-title="Ayuda" data-html="true" data-trigger="focus">
                        ❔
                      </button>
                      <div class="controls">
                        <textarea placeholder="- Nombres de los Invitados." cols="30" rows="5" th:field="${pleca.invitados_pleca}" type="text" name="text" class="form-control" required data-validation-required-message="Necesita ingresar los datos"></textarea>
                      </div>                     
                    </div>
                  </div>
                  <div class="col-lg-4 col-md-12">

                    <div class="row">
                      <div class="col-lg-12 col-md-12">
                          <div class="form-group">
                              <label>Titulo para la Transmision</label>
                              <div class="controls">
                                  <input th:field="${pleca.titulo_transmicion_pleca}" type="text" name="text" class="form-control" required data-validation-required-message="Necesita ingresar los datos">
                              </div>                      
                          </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-12">
                        <div class="form-group">
                          <label>URL del Video</label>
                          <button type="button" class="badge badge-pill badge-dark" data-toggle="popover" data-content="<b>Las URLs deben contener <br> 'http://' o 'https://'</b> <hr> <b> Ejemplo Url facebook. </b> <h6> https://fb.watch/mBUDI6FsaC/ </h6> <b>Ejemplo Url Youtube.</b> <h6>https://www.youtube.com/watch?v=6e4zayYH-VQ </h6> " data-original-title="Ayuda" data-html="true" data-trigger="focus">
                            ❔
                          </button>
                          <div class="controls">
                            <input placeholder="https://www.youtube.com/watch?v=JjKY_HNT5HM" th:field="${pleca.url_video_pleca}" type="text" name="text" class="form-control" required data-validation-required-message="Necesita ingresar los datos">
                          </div> 
                        </div>
                      </div>
                    </div>


                    
                    
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-10 col-md-12">
                    <button th:if="${pleca.id_pleca == null}" style="width: 100%;" type="submit" class="btn btn-success py-2">
                      <b>GUARDAR</b>
                    </button>
                    <button th:if="${pleca.id_pleca != null}" style="width: 100%;" type="submit" class="btn btn-info py-2">
                      <b>ACTUALIZAR INFORMACIÓN</b>
                    </button>
                  </div>
                  <div class="col-lg-2 col-md-12">
                    <a th:if="${pleca.id_pleca == null}" style="width: 100%;" href="#table_body" class="btn btn-warning py-2">
                      <b>Ver Lista</b>
                    </a>
                    <a th:if="${pleca.id_pleca != null}" href="/admin/RegistroPlecaA" style="width: 100%;" type="submit" class="btn btn-danger py-2">
                      <b>CANCELAR</b>
                    </a>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script>
    $(document).ready(function() {
    $('.selectM').select2();
    $('.selectB').select2();
    $('#form1').submit(function (event) {
        event.preventDefault();
        var form = document.getElementById("form1");
        var action = form.action;
        // Validar que los campos no ocultos no estén vacíos
        var camposNoOcultos = $(this).find('input[type!="hidden"], select');
        var camposVacios = camposNoOcultos.filter(function () {
          return !$(this).val();
        });

        if (camposVacios.length > 0) {
          // Mostrar un mensaje de error si hay campos vacíos
          Swal.fire({
            title: 'Error!',
            text: 'Por favor, complete todos los campos obligatorios.',
            icon: 'error',
            confirmButtonText: 'Entendido'
          });
          return;
        }
        var formData = $(this).serialize();

        $.ajax({
          type: 'POST',
          url: $(this).attr('action'),
          data: formData,
          contentType: 'application/x-www-form-urlencoded',
          success: function (response) {
            var mensaje = response;
            if (mensaje == "Registrar") {
              Swal.fire({
                title: 'Registro Exitoso!',
                icon: "success",
                showConfirmButton: false,
                timer: 1500
              })
            } else {
              Swal.fire({
                title: 'Actualización Exitosa!',
                icon: "success",
                showConfirmButton: false,
                timer: 1500
              })
            }
            cargarFormulario();
            cargarTabla();

          },
          error: function (xhr, status, error) {
            toastr.error('Ha ocurrido un error. Por favor, intenta nuevamente.' + xhr, status, error);
            console.error(error);
            // Manejo de errores
          }
        });

      });
    });
  </script>